# food-consumption-analyzer

### Технологии:
- Spring Boot
- Spring MVC
- Spring Data JPA
- Spring Test
- Flyway
- PostgreSQL + H2

### Цели:
- Получить дополнительный практический опыт написания REST-сервисов
- Углубить понимание возможностей Spring Data JPA
- Попрактиковаться в написании тестов и использовании Flyway

### Концепция:
Недавно я откликнулся на какую-то вакансию и получило сообщение о том, что для отклика нужно решить тест. Тестом это назвать было затруднительно,
потому что по сути в описании было дано небольшое Т.З.. Суть была в следующем: написать сервис, который позволяет зарегистрировать пользователя, 
высчитать для него норму калорий, создать блюдо, создать запись о приеме пищи, вернуть отчет о потребленной пищи за день/промежуток времени. Я решил ради 
интереса и практики попробовать написать этот сервис. Получилось примерно следующее: есть контроллер на который приходят основные запроса, там происходит
валдиация входных данных (важно сказать, что валдиация id пользователя и id блюд при создании записи о приеме пищи не осуществляется, потому что плодить лишние запросу в базу
нецелесообразно, а придумывать какой-то механизм кеширования у меня для этого проекта желания нет); есть несколько небольших сервисов которые создают блюда/пользователей/записи 
о приеме пищи (важно также сказать, что с приемами пищи у меня возникли некоторые трудности, суть в следующем: каждый прием пищи имеет дату, время, пользователя и список блюд,
в этот прием потребленных, разумеется трудность возникла с реляционным воплощением такого объекта, потому что в таблице нельзя в качестве поля использовать 
список (id-шников съеденных блюд), соответственно пришлось не очень изящно выходить из сложившейся ситуации, а именно создавать отдельную запись в таблице приемов 
пищи для каждого отличающегося id блюда); есть также дополнительный функционал у одного из сервисов, он создает отчеты о приемах пищи; есть репозитории с некоторыми
нативными запросами, которые приходится маппить с помощью @SqlResultSetMapping, в случае с простым чтением из таблицы c записями приемов пищи это обусловлено тем, 
что мне просто хотелось попробовать эту штуку и не хотелось использовать FetchType.EAGER и синтаксис JPQL, в случае с подсчетом общего числа калорий за день и извлечением
пользователя это, в целом, можно считать даже довольно удачным выходом из ситуации (когда надо извлечь некоторое число и некоторый объект); некоторые тесты. Стоит еще заметить,
что для создания схемы базы и записи туда данных используется Flyway, в тестовой среде используется база H2.      

### Компоненты:
- MainContoller - основной контроллер приложения
- BaseAdvice - примитивный exceptionHandler, просто добавляет в тело ответа мапу с ключом: "exception" и мессаджем ошибки
- User, Dish, Meal - сущности описывающие таблицы базы с информацией о пользователе, блюде и приеме пищи соответственно
- MealInfo - класс для создания записи о приеме пищи, содержит информацию о дате, времени, id пользователя и id блюд
- MealDTO - класс содержащий информацию о времени приема пищи и списке блюд, нужен только для того, чтобы использовать внутри
класса DailyReport, потому что использовать сущность Meal неэффективно ввиду дублирования информация
- Report - интерфейс без методов, нужен просто для того, чтобы логически связать следующие объекты:
    - DailyReport - отчет за день, содержит: дату, список объектов MealDTO, количество калорий, уложился ли пользователь в норму
    - HistoryReport - отчет за период времени, содержит: первый день, последний день, список объектов DailyReport
    - У этих классов по сути нет общего функционала, но логически и тот и тот являются отчетом, поэтому я решил связать
    их интерфейсом Report чтобы можно было помещать их в ReportContainer
- ReportContainer - класс-контейнер в котором лежит объект User и объект Report
- ***Repository - основные репозитории
- ***Service - основные сервисы
- CalorieCalculator - интерфейс который предполагает возможность рассчитать количество калорий для пользователя в соответствии с его физиологическими данными:
    - HarrisBenedictCalculator - реализация CalorieCalculator, которая рассчитывает норму калорий в соответствии с формулой Харриса-Бенедикта, 
    не знаю насколько правильно я ее реализовал, а также не знаю насколько правильно учитываю цель пользователя при рассчете нормы калорий, но 
    в сущности это не имеет значения для приложения
- MealServiceTest - тест для проверки корректности создания записи о приеме пищи, а также создания отчетов
- MainContollerTest - тест для проверки основныех endpoint'ов, помимо прочего там много однотипных кейсов которые не 
имеют особенного смысла (в основном для проверки работы constraint аннотаций), я их написал в первую очередь из чувства перфекционизма,
также я не написал тесты для endpoint'ов с отчетами (кроме пары fail-кейсов), потому что корректность создания отчетов я уже проверил 
в тесте MealServiceTest.
